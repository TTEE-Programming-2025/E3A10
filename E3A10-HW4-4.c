#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct Student {
    char name[20];
    int id;
    int math;
    int physics;
    int english;
    float average;
};

struct Student students[MAX];
int studentCount = 0;

void welcome();

void welcome(){
	printf("                   .-                                                                               \n");
	printf("                   -===.                                                                            \n");
	printf("                   -+--=-                                                                           \n");
	printf("                   :+=---=:                                                                         \n");
	printf("                   :++=---==.                                                                       \n");
	printf("                   .*++=------+-                                                                    \n");
	printf("                    *+++=-------=:                                                                  \n"); 
	printf("                    *+++=--------==.    :.                   .--==                                  \n");
	printf("                    *++++=------===+-   +*-   ..        .-=+**++*.                                  \n"); 
	printf("                    ++++++====---=+==+: #***:.**:   :=+******++*.                                   \n"); 
	printf("                    +++++++=======+++++*#****#***-=***********#:                                    \n"); 
	printf("     ::             =+++++++=+++++++++++++++++++++++*********#-                                     \n"); 
	printf("     =-+=.          :*+++++++++++++++++=========+++++++++***#+:--===+                               \n"); 
	printf(" .--=+*++++=-       .*+++++++++++==--------------=====++++++********.                               \n"); 
	printf(" :===+++++=--==:     *++++++++=---------------------===+++++++++***..:::...:::::---=---------::..   \n"); 
	printf("   :++++++=-----=-.  +++++*+=-------------------------==++++++++++++==--======----------------+**.  \n");
	printf("   .+++++++=------==-*+**+++=--------------------------===+++++++++++=-------------------==++++:    \n");
	printf("  .++++++++++=----==+##*+++=---------------------------====+++++++++++=---------------==++++*-      \n");
	printf("    :=*+++++++=--=++*#+++==----------------------------====++++++++++++==--------===++++++*=        \n");
	printf("      .+++++++++===+++++++=-----------------------------===+=+++++++++====---==+++++++++*+.         \n");
	printf("       .*++++++++++++++++=----=-------------------------===++++++++++++====+++++++++++*+.           \n");
	printf("        :++++++++++++++++====-+-----------------------====++++++++++++++++++++++++++*+:             \n");
	printf("         =++++++++++++++++++++-+---------------------==+++++++++++++++++++++++++++++:               \n");
	printf("          =+++++++++++++++++=..==------------------==++++++++++++++++++++++++++++*:                 \n");
	printf("           =++*++++++++++++=...:+----------------===+++++++++++++++++++++++++++*-                   \n");
	printf("            **++++++++++++*.....-*=--===------==+++++++++++++++++++++++++++++*-                     \n");
	printf("            +++++++++++++++.....:*+++=+++=====++++++++++++++***+++++++++*++*=                       \n");
	printf("           :+++++++++++++++.....:%*++++++++++++++==++++++++=:*+++++++++++#=.                        \n");
	printf("           +=++++++++#++++*-....:+++++++++++++++===++++*=:::.#+++++++++++*:.                        \n");
	printf("          .+==+++++++**+++++=..::::*++++++++++++==++*+=::::::*+++++++++++#+***+++====---:.          \n");
	printf("          =-===++++++:.*+++++*=-:::=++++++++++++++*#:...::::+++++++++++++#++++++++++++=--==+=       \n");
	printf("          +--==+++++*: .=++++++++***+++++++++++++--=.....:::*++++++++++++*++++++++++++++++**:       \n");
	printf("          #====++++++-   -*++++++++++++++++++*#:........::-+++++++++++++++++++++++++++++++++-==     \n");
	printf("          *=====+++++=   :-=*+++++++++++++++++++-......:-=++++++++++++++++++++++++++++++++++=-      \n");
	printf("          *=====++***#.  =...-+*+++++++++++++++++*++=+++++++++++++++++++++++++++++++++++++*.        \n");
	printf("          *====+++****+ .-......=*+*++++++++++++++++++++++++**+++++++++++++++++++++++*+=-+*         \n");
	printf("          +=====******#=-.......-...-=+**++++++++++++++++**#*+++++++++++++++++++++*+=.              \n");
	printf("          ++++==+*******#.......=........:-=*+++***+**==-:-*++++++++*+**++++++**=-                  \n");
	printf("        =##%*++***############==...........=....   .- -**************#.                             \n");
	printf("       .#####***################*=-.......-:..     ==*###############-                              \n");
	printf("       =+**##***#####################*==--+...:-=+*#################+                               \n");
	printf("       *++**##**###################################################*                                \n");
	printf("       *++++**#####################################################.                                \n");
	printf("       ++++++**###################################################.                                 \n");
	printf("       .*+++++**###################################**+++++**#%%##.                                  \n");
	printf("        =*+++++*################################**+++++++++***##.                                   \n");
	printf("         =#*++**###############################*+++++++++++****#:                                   \n");
	printf("          .+##################################*++++++++++++*****+                                   \n");
	printf("            .-%########+#**##################**++++++++++++******                                   \n");
	printf("              +#######* .=#***##############****+++++++=++*******                                   \n");
	printf("               =#*##+=+    -+##*############****++**++++++++++++*                                   \n");
	printf("                . :+.        .-+%%##########***+++++++++++++++++=                                   \n");
	printf("                                -###%%%%%-:.+*+++++++++++++++++*.                                   \n");
	printf("                                 .*#####:    -*++++*%***#++++++=                                    \n");
	printf("                                   -*##*      =+++###%######++=                                     \n");
	printf("                                      :        ++*#########**-                                      \n");
	printf("                                               .**########*+.                                       \n");
	printf("                                                -**######+:                                         \n");
	printf("                                                 .-=+*+=.                                           \n");
	system("PAUSE");
	system("cls");// 清除螢幕
}

int main() {
    char choice;
    int password, tries = 0, i;

	welcome();

    while (tries < 3) {
        printf("請輸入4位數密碼（預設為2025）：");
        if (scanf("%d", &password) != 1) {  // * 改進：處理非數字輸入
            printf("密碼格式錯誤！請輸入數字。\n");
            while (getchar() != '\n'); // * 清除輸入緩衝區
            tries++;
            continue;
        }
        if (password == 2025) {
            printf("登入成功！歡迎使用成績系統！\n");
            break;
        } else {
            printf("密碼錯誤！\n");
            tries++;
        }
    }
    if (tries == 3) {
        printf("密碼錯誤三次，系統結束！\n");
        return 0;
    }
    
}
    // 主選單操作
    while (1) {
        printf("------------[Grade System]------------\n");
        printf("|a.Enter student grades              |\n");
        printf("|b.Display student grades            |\n");
        printf("|c.Search for student grades         |\n");
        printf("|d.Grade ranking                     |\n");
        printf("|e.Exit system                       |\n");
        printf("--------------------------------------\n");
        printf("Enter your choice: ");
        scanf(" %c", &choice);
        switch (choice) {
            case 'a': enterGrades(); break;
            case 'b': displayGrades(); break;
            case 'c': searchGrades(); break;
            case 'd': rankGrades(); break;
            case 'e': {
                char confirm;
                do {
                    printf("確定離開？(y/n)：");
                    scanf(" %c", &confirm);
                    if (confirm == 'y') {
                        printf("系統結束，掰掰！\n");
                        return 0;
                    }
                } while (confirm != 'y' && confirm != 'n');
                break;
            }
            default:
                printf("無效選項，請重新輸入。\n");
        }
    }
    return 0;
}
// 輸入學生成績
void enterGrades() {
	int i;
    system("cls");
    do {
        printf("請輸入學生人數（5~10）：");
        if (scanf("%d", &studentCount) != 1) {  // * 加入錯誤處理：非數字輸入
            printf("輸入錯誤，請輸入一個整數！\n");
            while (getchar() != '\n');  // * 清除緩衝區
            studentCount = 0;
            continue;
        }
        if (studentCount < 5 || studentCount > 10) {
            printf("輸入錯誤，請輸入介於 5 到 10 的數字！\n");
        }
    } while (studentCount < 5 || studentCount > 10);
    for (i = 0; i < studentCount; i++) {
        printf("第%d位學生\n", i + 1);
        printf("姓名：");
        scanf("%s", students[i].name);

        int valid = 0;
        while (!valid) {
            printf("學號（6位數）：");
            if (scanf("%d", &students[i].id) != 1) {  // * 錯誤處理：非數字輸入
                printf("輸入錯誤，請輸入數字學號。\n");
                while (getchar() != '\n');
                continue;
            }
            if (students[i].id >= 100000 && students[i].id <= 999999) {
                valid = 1;
            } else {
                printf("錯誤：學號必須是 6 位數字。\n");
            }
        }

        do {
            printf("數學成績（0~100）：");
            if (scanf("%d", &students[i].math) != 1) {  // * 非數字成績處理
                printf("輸入錯誤，請輸入數字！\n");
                while (getchar() != '\n');
                students[i].math = -1;
                continue;
            }
            if (students[i].math < 0 || students[i].math > 100)
                printf("分數需介於 0 到 100。\n");
        } while (students[i].math < 0 || students[i].math > 100);

        do {
            printf("物理成績（0~100）：");
            if (scanf("%d", &students[i].physics) != 1) {
                printf("輸入錯誤，請輸入數字！\n");
                while (getchar() != '\n');
                students[i].physics = -1;
                continue;
            }
            if (students[i].physics < 0 || students[i].physics > 100)
                printf("分數需介於 0 到 100。\n");
        } while (students[i].physics < 0 || students[i].physics > 100);

        do {
            printf("英文成績（0~100）：");
            if (scanf("%d", &students[i].english) != 1) {
                printf("輸入錯誤，請輸入數字！\n");
                while (getchar() != '\n');
                students[i].english = -1;
                continue;
            }
            if (students[i].english < 0 || students[i].english > 100)
                printf("分數需介於 0 到 100。\n");
        } while (students[i].english < 0 || students[i].english > 100);

        students[i].average = (students[i].math + students[i].physics + students[i].english) / 3.0;
    }
    printf("輸入完成，返回主選單...\n");
    system("pause");
    system("cls");
} 
